<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Map</title>
    <link href='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.css' rel='stylesheet' />
    <style>
        #map{
            width: 100%;
            height: 80vh;
        }
        .mapboxgl-popup-content {
            text-wrap: none;
            padding: 5px 5px 0px;
        }
        .mapboxgl-popup-content>p, h4 {
            margin: 2px;
        }
    </style>

</head>
<body>


<div id='map'></div>
<!-- Scripts in div below-->
<div>
<!--    Link to hidden API keys-->
    <script src="js/keys.js"></script>
<!--    Link to jQuery-->
    <script src="https://code.jquery.com/jquery-3.6.1.js" integrity="sha256-3zlB5s2uwoUzrXK3BT7AX3FyvojsraNFxCc2vC/7pNI=" crossorigin="anonymous"></script>
<!--    Link to mapbox-->
    <script src='https://api.mapbox.com/mapbox-gl-js/v2.10.0/mapbox-gl.js'></script>
<!--    Create the map-->
    <script>
        mapboxgl.accessToken = mapBoxKey2;
        const map = new mapboxgl.Map({
            container: 'map', // container ID
            style: 'mapbox://styles/mapbox/streets-v11', // style URL
            center: [-105.074746, 40.3969214], // starting position [lng, lat]
            zoom: 9, // starting zoom
            projection: 'globe' // display the map as a 3D globe
        });
        map.on('style.load', () => {
            map.setFog({}); // Set the default atmosphere style
        });
    </script>
</div>
<script>
    "use strict";
    let popupID = 0
    let currentLat = 40.3969214
    let currentLon = -105.074746

    // check for proper assignment of 'location' in 'if' statement in reverse geocoding get request in addCurrentWeatherPopup(): working properly
    // let currentLat = 53.835125
    // let currentLon = -106.327508

    // API Calls
    function addCurrentWeatherPopup(){
        let location = "";
        $.ajax(`http://api.openweathermap.org/geo/1.0/reverse?lat=${currentLat}&lon=${currentLon}&appid=${openWeatherKey2}`).done(function (data){
            console.log(data)
            if (data[0].state !== 'undefined'){
                location = data[0].state
            } else {
                location = [0].country
            }
            location = data[0].state;
            console.log(location);

            // $(`#h1SpanID${popupID}`).html(`${data[0].state}`)
            $.ajax(`https://api.openweathermap.org/data/2.5/weather?lat=${currentLat}&lon=${currentLon}&appid=${openWeatherKey2}&units=imperial`).done(function (data){
                console.log(data);

                new mapboxgl.Marker()
                    .setLngLat(data.coord)
                    .setPopup(new mapboxgl.Popup().setHTML(
                        `<h1>${data.name}, ${location}</h1><hr>
                     <h4>${data.weather[0].description}</h4>
                     <p>Temperature : ${data.main.temp}&#8457</p>
                     <p>Feels Like : ${data.main.feels_like}&#8457</p>
                     <p>Humidity : ${data.main.humidity}%</p>
                     <p>Wind Speed : ${data.wind.speed}mph</p>
                     <p>Popup ID #${popupID}</p>`))
                    .togglePopup()
                    .addTo(map);


                popupID += 1;

        })

        })
    }
    addCurrentWeatherPopup();





    /**
     * API CALLS
     * Direct Geocoding
     * http://api.openweathermap.org/geo/1.0/direct?q={city name},{state code},{country code}&limit={limit}&appid={API key}
     * q	required	City name, state code (only for the US) and country code divided by comma. Please use ISO 3166 country codes.
     * appid	required	Your unique API key (you can always find it on your account page under the "API key" tab)
     * limit	optional	Number of the locations in the API response (up to 5 results can be returned in the API response)
     *
     */





    //
    // })




</script>
</body>
</html>